"0","# get just the domains from the emails"
"0","email_domains <- users_gh %>% drop_na(email) %>%"
"0","dt_mutate(domains = str_replace_all(email, ""^[a-zA-Z0-9_.+-]+@"", """"))"
"0","# match academic institutions from hipolabs to users based on email domains"
"0","# only impute company when it was NA"
"0","imputed_institutions <- email_domains %>%"
"0","  as.data.table() %>%"
"0","  inner_join(drop_na(institutions_hipolabs, domains)) %>%"
"0","  subset(is.na(company)) %>%"
"0","  dt_mutate(organization = institution)"
"2","Joining, by = ""domains""
"
"0","nrow(imputed_institutions)"
"1","[1]"
"1"," 11760"
"1","
"
"0","# 11,760 imputed"
"0","# join with other recoded data to update academic counts"
"0","orgs_clean <- full_join(orgs_clean, imputed_institutions[,c(""login"",""email"",""organization"")])"
"2","Joining, by = c(""login"", ""email"", ""organization"")
"
"0","org_counts <- orgs_clean %>% group_by(organization) %>% count() %>% arrange(-n) "
"0","overlap <- semi_join(org_counts, institutions_hipolabs, by = c(""organization"" = ""institution""))"
"0","sum(overlap[,""n""])"
"1","[1]"
"1"," 40894"
"1","
"
